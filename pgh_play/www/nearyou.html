<html>
	<head>
		<link rel="stylesheet" type="text/css" href="css/nearyou.css">
		<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Karla">
		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
		<script src="http://maps.googleapis.com/maps/api/js">//Imports the Google Maps API</script>
		<script>

google.maps.event.addDomListener(window, 'load', initialize);
		
/**
 *	function initialize()
 *
 *	Initializes the Google Map in the #googleMap div by first reading the GET variables
 *	in the page's URL and calling the appropriate function to either Geocode the user's
 * 	inputted zip code or their current location.
 */
function initialize() {
	// Gets the URL from the current page
	var URL = window.location.href;
	
	// If there are GET variables in the URL
	if (URL.indexOf('?') !== -1) {
		// Split the URL String on the '?' character to grab the GET variables within it
		var split_URL = URL.split('?');
		var get_vars = split_URL[1];
		
		// First we check to see if the 'zipcode' GET variable is in the list of GET variables
		var zip_index = get_vars.indexOf('zipcode');
		
		// If so, we call the getZip() function, sending it the inputted zipcode as a parameter
		if (zip_index !== -1) {
			getZip(get_vars.substring(zip_index + 8, zip_index + 14));
		}
		
		// Then we check to see if the 'location' GET variable is in the list
		var loc_index = get_vars.indexOf('location');
		
		// In which case we call the getLocation() function
		if (loc_index !== -1) {
			getLocation();
		}
	}
}

/**
 *	function getZip()
 *
 *	Receives the zip code from the form submitted by the user in browse.html,
 *	then geocodes the zip code via the Google Maps API and sends the geocoded value
 * 	to the makeMap() function, which then creates the Map around those coordinates.
 *
 *	Param: zip — the user-inputted zipcode, which we received as a GET variable
 */
function getZip(zip) {
	// Initialize a new Geocoder object, which lets us obtain latitude/longitude 
	// values from an address or zip code.
	var geocoder = new google.maps.Geocoder();
	
	var lat;
	var lng;
	
	// Use the Maps geocode() function to obtain the location from the zip code
	geocoder.geocode( { 'address': zip }, function(results, status) {
		if (status == google.maps.GeocoderStatus.OK) {
			
			// When the Geocoder returns an OK message, we receive the latitude and longitude
			lat = results[0].geometry.location.lat();
			lng = results[0].geometry.location.lng();
	
			// Then call the makeMap() function, which actually generates the Google Map
			makeMap(lat, lng);
		} 
	});
}

/**
 * 	function getLocation()
 *
 * 	Returns: The client's current latitude and longitude as a String.
 */
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
    } 
	else { 
        alert("Geolocation is not supported by this browser.");
    }
}

function showPosition(position) {
	makeMap(position.coords.latitude, position.coords.longitude);
}

/**
 * 	function makeMap()
 *
 *	Params: lat — the latitude, lng — the longitude
 */
function makeMap(lat, lng) {
	//alert('6. Latitude: ' + lat + ' Logitude: ' + lng);

	var mapCanvas = document.getElementById("googleMap");
	var mapOptions = {
		center: new google.maps.LatLng(lat, lng),
		zoom: 15,
		mapTypeId: google.maps.MapTypeId.ROADMAP
	}
	map = new google.maps.Map(mapCanvas, mapOptions);

	map.set('styles', [
		{
			featureType: 'road',
			elementType: 'geometry',
			stylers: [
				{ color: '#000000' },
				{ weight: 0.2 }
			]
		},
		{
			featureType: 'poi.park',
			elementType: 'geometry',
			stylers: [
				{ hue: '#85CF61' },
				{ lightness: -5 },
				{ saturation: 99 }
			]
		}
	]);

   	/**
   	 *  TODO:
   	 *
   	 *	Get AJAX return value from PHP DB — all nearby parks of user-
   	 *	inputted location. Then dynamically add each park to #park_list
   	 */
}

/**
 *	function addMarker()
 *
 *	Adds a Marker object to the Map based on a specified feature
 *	Params: feature —— the feature that the Marker is 
 */
function addMarker(feature) {
	var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/';
	var marker = new google.maps.Marker({
		position: new google.maps.LatLng(40.43473, -79.94318),
		icon: iconbase + feature,
		// icon: icons[feature.type].icon (?)
		map: map
	});
}

		</script>
	</head>
	<body>
		<div id="container">
			<div id="header">
				<div class="left">
					<div class="l1">
						<i class="fa fa-chevron-left" id="backward" onclick="window.location.href = 'browse.html'"></i>
					</div>
					<div class="l2">
						<p id="title">PGH PLAY PROJECT</p>
					</div>
				</div>
				<div class="right">
					<div class="r">
						<i class="fa fa-plus" id="plus"></i>
						<i class="fa fa-bars" id="bars"></i>
					</div>
				</div>
			</div>
			<div id="near_you"></div>
			<p id="nearyou_text" style="font-family: Karla">NEAR YOU</p>
			<div id="googleMap"></div>
			<div id="list">
				<ul id="park_list">
					<li>Park 1</li>
					<li>Park 2</li>
					<li>Park 3</li>
					<li>Park 4</li>
					<li>Park 5</li>
					<li>Park 6</li>
					<li>Park 8</li>
					<li>Park 9</li>
					<li>Park 10</li>
					<li>Park 11</li>
					<li>Park 12</li>
					<li>Park 13</li>
					<li>Park 14</li>
					<li>Park 15</li>
					<li>Park 16</li>
					<li>Park 17</li>
					<li>Park 18</li>
					<li>Park 19</li>
					<li>Park 20</li>
				</ul>
			</div>
		</div>
	</body>
</html>